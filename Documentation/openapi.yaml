openapi: 3.0.1
info:
  title: EpiTrello2.0 - Auth & Projects API
  version: "1.1.0"
  description: Authentication and Project endpoints for EpiTrello2.0
servers:
  - url: http://localhost:5000
    description: Local dev server
tags:
  - name: auth
    description: Authentication operations
  - name: projects
    description: Project management operations
paths:
  /api/auth/register:
    post:
      tags: [auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        "201":
          description: User registered
  /api/auth/login:
    post:
      tags: [auth]
      summary: Login and receive JWT (token returned in body and also set as Authorization response header)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        "200":
          description: Login successful
          headers:
            Authorization:
              description: Bearer token header (also returned in response body)
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
  /api/auth/ping:
    get:
      tags: [auth]
      summary: Protected ping endpoint, requires Bearer token
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Pong with authenticated user info
  /api/projects:
    get:
      tags: [projects]
      summary: Get all projects for the authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
    post:
      tags: [projects]
      summary: Create a new project (authenticated)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        "201":
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateProjectResponse'
  /api/projects/{id}:
    get:
      tags: [projects]
      summary: Get project details
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        "200":
          description: Project object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
    delete:
      tags: [projects]
      summary: Delete a project (Owner only)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        "200":
          description: Project deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  projectId:
                    type: string
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/projects/{id}/invite:
    post:
      tags: [projects]
      summary: Invite a user by name to a project (requires invite permission)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteRequest'
      responses:
        "200":
          description: Invitation sent
  /api/projects/{id}/accept:
    post:
      tags: [projects]
      summary: Accept an invitation to join the project (authenticated)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        "200":
          description: Invitation accepted
  /api/projects/{id}/decline:
    post:
      tags: [projects]
      summary: Decline an invitation to join the project (authenticated)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        "200":
          description: Invitation declined
  /api/projects/{id}/revokeInvitation:
    post:
      tags: [projects]
      summary: Revoke an invitation sent to a user (Owner/Administrator only)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteRequest'
      responses:
        "200":
          description: Invitation revoked
  /api/projects/{id}/remove/{memberId}:
    post:
      tags: [projects]
      summary: Remove a member from the project (Owner/Administrator only). A user cannot remove themselves; they must leave the project. Administrators cannot remove Owners and other Administrators.
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - name: memberId
          in: path
          required: true
          schema:
            type: string
          description: member public id (uuid or mongo _id)
      responses:
        "200":
          description: Member removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/projects/{id}/leave:
    post:
      tags: [projects]
      summary: Leave the project (authenticated user). The owner cannot leave the project. They must delete the project.
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        "200":
          description: Left the project
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/projects/{id}/members/{memberId}/role:
    patch:
      tags: [projects]
      summary: Change a member role (Owner/Administrator only)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - name: memberId
          in: path
          required: true
          schema:
            type: string
          description: member public id (uuid or mongo _id)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangeRoleRequest'
      responses:
        "200":
          description: Role updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/projects/invitations:
    get:
      tags: [projects]
      summary: Get all project invitations for the authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of project invitations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    projectId:
                      type: string
                    projectName:
                      type: string
                    invitedBy:
                      type: string
                    createdAt:
                      type: string
                      format: date-time
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    projectId:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: Project uuid or mongo _id

  schemas:
    RegisterRequest:
      type: object
      required: [name, password]
      properties:
        name:
          type: string
        password:
          type: string
    LoginRequest:
      type: object
      required: [name, password]
      properties:
        name:
          type: string
        password:
          type: string
    LoginResponse:
      type: object
      properties:
        message:
          type: string
        token:
          type: string
        id:
          type: string
    CreateProjectRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    CreateProjectResponse:
      type: object
      properties:
        message:
          type: string
        project:
          $ref: '#/components/schemas/Project'
    Project:
      type: object
      properties:
        uuid:
          type: string
        id:
          type: string
        name:
          type: string
        ownerId:
          type: string
        members:
          type: array
          items:
            $ref: '#/components/schemas/ProjectMember'
        invitations:
          type: array
          items:
            $ref: '#/components/schemas/Invitation'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    ProjectMember:
      type: object
      properties:
        userId:
          type: string
        role:
          type: string
          enum:
            - Reader
            - Contributer
            - Administrator
            - Owner
    Invitation:
      type: object
      properties:
        name:
          type: string
        invitedBy:
          type: string
        createdAt:
          type: string
          format: date-time
    InviteRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    ChangeRoleRequest:
      type: object
      required: [role]
      properties:
        role:
          type: string
          enum:
            - Reader
            - Contributer
            - Administrator
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
