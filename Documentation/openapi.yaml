openapi: 3.0.1
info:
  title: EpiTrello2.0 - Full API
  version: "1.2.0"
  description: Authentication, Projects, Columns, Cards and Checklists API for EpiTrello2.0
servers:
  - url: http://localhost:5000
    description: Local dev server
tags:
  - name: auth
    description: Authentication operations
  - name: projects
    description: Project management operations
  - name: tags
    description: Tag management operations
  - name: columns
    description: Column management operations
  - name: cards
    description: Card management operations
  - name: checklists
    description: Checklist operations
paths:
  /api/auth/register:
    post:
      tags: [auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Created
  /api/auth/login:
    post:
      tags: [auth]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          headers:
            Authorization:
              schema:
                type: string
  /api/auth/ping:
    get:
      tags: [auth]
      summary: Protected ping
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Pong
  /api/projects:
    post:
      tags: [projects]
      summary: Create project
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created
    get:
      tags: [projects]
      summary: List projects for authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: list
  /api/projects/{projectId}:
    get:
      tags: [projects]
      summary: Get project details
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Project object
    delete:
      tags: [projects]
      summary: Delete project (owner only)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Deleted
  /api/projects/{projectId}/invite:
    post:
      tags: [projects]
      summary: Invite user by name
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteRequest'
      responses:
        '200':
          description: Invitation sent
  /api/projects/{projectId}/accept:
    post:
      tags: [projects]
      summary: Accept invitation (authenticated)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Invitation accepted
  /api/projects/{projectId}/decline:
    post:
      tags: [projects]
      summary: Decline invitation
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Invitation declined
  /api/projects/{projectId}/revokeInvitation:
    post:
      tags: [projects]
      summary: Owner revoke sent invitation
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteRequest'
      responses:
        '200':
          description: Invitation revoked
  /api/projects/{projectId}/remove/{memberId}:
    post:
      tags: [projects]
      summary: Remove a member from project
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - name: memberId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Member removed
  /api/projects/{projectId}/members/{memberId}/role:
    patch:
      tags: [projects]
      summary: Change a member role
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - name: memberId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangeRoleRequest'
      responses:
        '200':
          description: Role updated
  /api/projects/{projectId}/columns:
    post:
      tags: [columns]
      summary: Create column in project
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateColumnRequest'
      responses:
        '201':
          description: Column created
    get:
      tags: [columns]
      summary: List columns for project
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: list
  /api/projects/:project_id/tags:
    post:
      tags: [tags]
      summary: Create a new tag in the project
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                color:
                  type: string
      responses:
        '201':
          description: Tag created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  newTag:
                    $ref: '#/components/schemas/Tag'
  /api/projects/{projectId}/tags/{tagId}:
    delete:
      tags: [tags]
      summary: Delete a tag from the project
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/tagId'
      responses:
        '204':
          description: Tag deleted
    patch:
      tags: [tags]
      description: Update a tag's details
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/tagId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                color:
                  type: string
      responses:
        '200':
          description: Tag updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  updatedTag:
                    $ref: '#/components/schemas/Tag'

  /api/projects/{projectId}/tags/attach/{tagId}/{cardId}:
    post:
      tags: [tags]
      summary: Attach a tag to a card
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/tagId'
        - $ref: '#/components/parameters/cardId'
      responses:
        '200':
          description: Tag attached to card
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/projects/{projectId}/tags/detach/{tagId}/{cardId}:
    post:
      tags: [tags]
      summary: Detach a tag from a card
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/tagId'
        - $ref: '#/components/parameters/cardId'
      responses:
        '200':
          description: Tag detached from card
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/projects/{projectId}/columns/{columnId}/cards:
    post:
      tags: [cards]
      summary: Create card in a column
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCardRequest'
      responses:
        '201':
          description: Card created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  newCard:
                    $ref: '#/components/schemas/Card'
  /api/projects/{projectId}/columns/{columnId}/cards/{cardId}:
    patch:
      tags: [cards]
      summary: Update card
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCardRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  updatedCard:
                    $ref: '#/components/schemas/Card'
    delete:
      tags: [cards]
      summary: Delete card
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
      responses:
        '204':
          description: Deleted
  /api/projects/{projectId}/columns/{columnId}/cards/{cardId}/checklists:
    post:
      tags: [checklists]
      summary: Create checklist on card
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChecklistRequest'
      responses:
        '201':
          description: Checklist created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  newChecklist:
                    $ref: '#/components/schemas/Checklist'
  /api/projects/{projectId}/columns/{columnId}/cards/{cardId}/checklists/{checklistId}:
    patch:
      tags:
        - checklists
      summary: Update checklist
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
        - $ref: '#/components/parameters/checklistId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateChecklistRequest'
      responses:
        '200':
          description: Checklist updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  updatedChecklist:
                    $ref: '#/components/schemas/Checklist'
    delete:
      tags: [checklists]
      summary: Delete checklist
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
        - $ref: '#/components/parameters/checklistId'
      responses:
        '204':
          description: Deleted

  /api/projects/{projectId}/columns/{columnId}/cards/{cardId}/checklists/{checklistId}/items:
    post:
      tags: [checklists]
      summary: Add item to checklist
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
        - $ref: '#/components/parameters/checklistId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddChecklistItemRequest'
      responses:
        '201':
          description: Item added
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  newItem:
                    $ref: '#/components/schemas/ChecklistItem'
  /api/projects/{projectId}/columns/{columnId}/cards/{cardId}/checklists/{checklistId}/items/{itemId}:
    patch:
      tags: [checklists]
      summary: Update checklist item (e.g., toggle checked status, change content etc.)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
        - $ref: '#/components/parameters/checklistId'
        - $ref: '#/components/parameters/itemId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateChecklistItemRequest'
      responses:
        '200':
          description: Item updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  updatedItem:
                    $ref: '#/components/schemas/ChecklistItem'
    delete:
      tags: [checklists]
      summary: Remove checklist item
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/columnId'
        - $ref: '#/components/parameters/cardId'
        - $ref: '#/components/parameters/checklistId'
        - $ref: '#/components/parameters/itemId'
      responses:
        '204':
          description: Item removed

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    projectId:
      name: projectId
      in: path
      required: true
      schema:
        type: string
      description: Project uuid
    columnId:
      name: columnId
      in: path
      required: true
      schema:
        type: string
      description: Column mongo _id
    cardId:
      name: cardId
      in: path
      required: true
      schema:
        type: string
      description: Card mongo _id
    checklistId:
      name: checklistId
      in: path
      required: true
      schema:
        type: string
      description: Checklist mongo _id
    itemId:
      name: itemId
      in: path
      required: true
      schema:
        type: string
      description: Checklist Item mongo _id
    tagId:
      name: tagId
      in: path
      required: true
      schema:
        type: string
      description: Tag mongo _id

  schemas:
    RegisterRequest:
      type: object
      required: [name, password]
      properties:
        name:
          type: string
        password:
          type: string
    LoginRequest:
      type: object
      required: [name, password]
      properties:
        name:
          type: string
        password:
          type: string
    LoginResponse:
      type: object
      properties:
        message:
          type: string
        token:
          type: string
        id:
          type: string
    CreateProjectRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    CreateProjectResponse:
      type: object
      properties:
        message:
          type: string
        project:
          $ref: '#/components/schemas/Project'
    Project:
      type: object
      properties:
        uuid:
          type: string
        id:
          type: string
        name:
          type: string
        ownerId:
          type: string
        members:
          type: array
          items:
            $ref: '#/components/schemas/ProjectMember'
        invitations:
          type: array
          items:
            $ref: '#/components/schemas/Invitation'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    ProjectMember:
      type: object
      properties:
        userId:
          type: string
        role:
          type: string
          enum:
            - Reader
            - Contributer
            - Administrator
            - Owner

    Card:
      type: object
      properties:
        _id:
          type: string
        title:
          type: string
        description:
          type: string
        isDone:
          type: boolean
        dueDate:
          type: string
          format: date-time
        startDate:
          type: string
          format: date-time
        tagIds:
          type: array
          items:
            type: string
          description: Array of tag IDs
        assignedTo:
          type: array
          description: Array of user IDs
          items:
            type: string
        checklists:
          type: array
          items:
            $ref: '#/components/schemas/Checklist'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Checklist:
      type: object
      properties:
        _id:
          type: string
        title:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/ChecklistItem'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    Invitation:
      type: object
      properties:
        name:
          type: string
        invitedBy:
          type: string
        createdAt:
          type: string
          format: date-time
    ChecklistItem:
      type: object
      properties:
        _id:
          type: string
        text:
          type: string
        isChecked:
          type: boolean
        dueDate:
          type: integer
          format: int64
          description: Unix timestamp in milliseconds
        assignedTo:
          type: array
          description: Array of user IDs
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    InviteRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    ChangeRoleRequest:
      type: object
      required: [role]
      properties:
        role:
          type: string
          enum:
            - Reader
            - Contributer
            - Administrator
    CreateColumnRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
    CreateColumnResponse:
      type: object
      properties:
        message:
          type: string
        column:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
    CreateCardRequest:
      type: object
      required: [title]
      properties:
        title:
          type: string
    UpdateCardRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
    CreateChecklistRequest:
      type: object
      required: [title]
      properties:
        title:
          type: string
    UpdateChecklistRequest:
      type: object
      properties:
        title:
          type: string
    AddChecklistItemRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string
    UpdateChecklistItemRequest:
      type: object
      properties:
        isChecked:
          type: boolean
        content:
          type: string
        dueDate:
          type: integer
          format: int64
          description: Unix timestamp in milliseconds
        assignedTo:
          type: array
          description: Array of user IDs
          items:
            type: string
    Tag:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        color:
          type: string
        createdAt:
          type: string
          format: date-time
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
